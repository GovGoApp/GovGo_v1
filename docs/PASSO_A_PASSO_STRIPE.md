# üéØ PASSO-A-PASSO: INTEGRA√á√ÉO STRIPE COMPLETA

## üìä SEUS PRODUTOS STRIPE

```
PLUS ‚Üí prod_TDCTCkvSbX4EwI
  ‚îî‚îÄ Pre√ßo: R$ 49,00/m√™s ‚Üí price_1SGm4w07BrIy6xMU6KEi2GKG

PRO ‚Üí prod_TDCUWvlmb503lF
  ‚îî‚îÄ Pre√ßo: R$ 199,00/m√™s ‚Üí price_1SGm5f07BrIy6xMUIu9Cn1MW

CORP ‚Üí prod_TDCVwbhfpMar99
  ‚îî‚îÄ Pre√ßo: R$ 999,00/m√™s ‚Üí price_1SGm6807BrIy6xMU0KBcDAUg
```

---

## üîó COMO FUNCIONA O LINK

### 1. Banco de Dados (system_plans)
```sql
id | code  | name      | price_month_brl
---|-------|-----------|----------------
1  | FREE  | Gratuito  | 0.00
2  | PLUS  | Plus      | 49.00
3  | PRO   | Pro       | 199.00
4  | CORP  | Corp      | 999.00
```

### 2. C√≥digo Python (PLAN_PRICE_MAP)
```python
PLAN_PRICE_MAP = {
    'PLUS': 'price_1SGm4w07BrIy6xMU6KEi2GKG',  # R$ 49/m√™s
    'PRO': 'price_1SGm5f07BrIy6xMUIu9Cn1MW',   # R$ 199/m√™s
    'CORP': 'price_1SGm6807BrIy6xMU0KBcDAUg',  # R$ 999/m√™s
}
```

### 3. Stripe Dashboard
- Cada **Product** tem um **Price** associado
- O **Price ID** √© usado para criar a cobran√ßa
- O **Product ID** √© s√≥ refer√™ncia (n√£o usado no c√≥digo)

### üîÑ Fluxo Completo
```
[Usu√°rio] Clica "Upgrade PLUS"
    ‚Üì
[GovGo] create_checkout_session(user_id='123', plan_code='PLUS')
    ‚Üì
[C√≥digo] Busca PLAN_PRICE_MAP['PLUS'] = 'price_1SGm4w...'
    ‚Üì
[Stripe API] stripe.checkout.Session.create(line_items=[{price: 'price_1SGm4w...'}])
    ‚Üì
[Stripe] Retorna checkout_url: "https://checkout.stripe.com/c/pay/cs_test_..."
    ‚Üì
[GovGo] Redireciona usu√°rio para checkout_url
    ‚Üì
[Usu√°rio] Preenche cart√£o e paga R$ 49,00
    ‚Üì
[Stripe] Processa pagamento e cria Subscription (sub_...)
    ‚Üì
[Stripe] Envia webhook: checkout.session.completed
    ‚Üì
[GovGo Webhook] handle_webhook_event()
    ‚Üì
[GovGo] upgrade_plan(user_id='123', plan_code='PLUS', subscription_id='sub_...')
    ‚Üì
[Database] UPDATE user_settings SET plan_id = 2 WHERE user_id = '123'
    ‚Üì
[Usu√°rio] Agora tem acesso ao plano PLUS! üéâ
```

---

## ‚úÖ PASSO 1: CONFIGURAR .ENV

Editar arquivo `.env` na raiz do projeto:

```bash
# =====================================
# STRIPE - PAYMENT GATEWAY
# =====================================

# API Secret Key (copiar do Stripe Dashboard ‚Üí Developers ‚Üí API Keys)
STRIPE_SECRET_KEY=sk_test_SUA_CHAVE_AQUI

# Price IDs dos seus produtos
STRIPE_PRICE_PLUS=price_1SGm4w07BrIy6xMU6KEi2GKG
STRIPE_PRICE_PRO=price_1SGm5f07BrIy6xMUIu9Cn1MW
STRIPE_PRICE_CORP=price_1SGm6807BrIy6xMU0KBcDAUg

# Webhook Secret (ser√° gerado no Passo 3)
STRIPE_WEBHOOK_SECRET=whsec_PREENCHER_DEPOIS

# URL do site
BASE_URL=http://localhost:8050

# Porta do webhook server
WEBHOOK_PORT=5001
```

**‚ö†Ô∏è ATEN√á√ÉO:** Voc√™ precisa copiar o **STRIPE_SECRET_KEY** do seu Dashboard!

**Como encontrar:**
1. Acessar: https://dashboard.stripe.com/test/apikeys
2. Copiar **Secret key** (come√ßa com `sk_test_...`)
3. Colar no `.env`

---

## ‚úÖ PASSO 2: EXECUTAR MIGRATION NO BANCO

Precisamos adicionar 2 colunas na tabela `user_settings` para armazenar os IDs do Stripe.

**Abrir Supabase:**
1. https://supabase.com/dashboard
2. Selecionar projeto GovGo
3. SQL Editor ‚Üí New Query

**Executar SQL:**
```sql
-- Adicionar colunas para IDs do Stripe
ALTER TABLE public.user_settings 
ADD COLUMN IF NOT EXISTS gateway_customer_id TEXT,
ADD COLUMN IF NOT EXISTS gateway_subscription_id TEXT;

-- Criar √≠ndices para performance
CREATE INDEX IF NOT EXISTS idx_user_settings_gateway_customer 
ON public.user_settings(gateway_customer_id);

CREATE INDEX IF NOT EXISTS idx_user_settings_gateway_subscription 
ON public.user_settings(gateway_subscription_id);
```

**Verificar se deu certo:**
```sql
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'user_settings' 
  AND column_name LIKE 'gateway%';
```

**Resultado esperado:**
```
column_name              | data_type
-------------------------|----------
gateway_customer_id      | text
gateway_subscription_id  | text
```

‚úÖ **Conclu√≠do!** Agora o banco est√° pronto para armazenar IDs do Stripe.

---

## ‚úÖ PASSO 3: INSTALAR DEPEND√äNCIAS

```powershell
cd "c:\Users\Haroldo Duraes\Desktop\Scripts\GovGo\v1"
pip install stripe>=7.0.0 flask>=3.0.0
```

**Verificar instala√ß√£o:**
```powershell
python -c "import stripe; print(f'Stripe v{stripe.__version__}')"
python -c "import flask; print(f'Flask v{flask.__version__}')"
```

**Resultado esperado:**
```
Stripe v7.x.x
Flask v3.x.x
```

---

## ‚úÖ PASSO 4: TESTAR LOCALMENTE COM STRIPE CLI

### 4.1 Instalar Stripe CLI

**Windows (Scoop):**
```powershell
scoop install stripe
```

**OU baixar manualmente:**
https://github.com/stripe/stripe-cli/releases/latest

### 4.2 Login no Stripe

```powershell
stripe login
```

Vai abrir o navegador. Clicar em **Allow access**.

### 4.3 Encaminhar Webhooks para Localhost

**Abrir Terminal 1:**
```powershell
stripe listen --forward-to localhost:5001/billing/webhook
```

**Resultado esperado:**
```
> Ready! Your webhook signing secret is whsec_abc123xyz... (^C to quit)
```

‚úÖ **COPIAR** esse `whsec_...` e colar no `.env` como `STRIPE_WEBHOOK_SECRET`

‚ö†Ô∏è **DEIXAR ESSE TERMINAL RODANDO!**

---

## ‚úÖ PASSO 5: INICIAR WEBHOOK SERVER

**Abrir Terminal 2:**
```powershell
cd "c:\Users\Haroldo Duraes\Desktop\Scripts\GovGo\v1\search\gvg_browser"
python gvg_billing_webhook.py
```

**Resultado esperado:**
```
üöÄ Webhook server running on http://localhost:5001/billing/webhook
üìä Health check: http://localhost:5001/billing/health
```

**Testar Health Check (Terminal 3):**
```powershell
curl http://localhost:5001/billing/health
```

**Deve retornar:**
```json
{"status": "healthy", "service": "gvg_billing_webhook"}
```

‚úÖ **Se retornou JSON acima, est√° funcionando!**

---

## ‚úÖ PASSO 6: TESTAR CRIA√á√ÉO DE CHECKOUT

**Abrir Terminal 4 (Python interativo):**
```powershell
cd "c:\Users\Haroldo Duraes\Desktop\Scripts\GovGo\v1\search\gvg_browser"
python
```

**Testar fun√ß√£o:**
```python
from gvg_billing import create_checkout_session

# Criar sess√£o para plano PLUS
result = create_checkout_session(
    user_id='test_user_001',
    plan_code='PLUS',
    email='teste@govgo.com.br',
    name='Haroldo Teste'
)

print(result)
```

**Resultado esperado:**
```python
{
    'checkout_url': 'https://checkout.stripe.com/c/pay/cs_test_abc123...',
    'session_id': 'cs_test_abc123...'
}
```

‚úÖ **Se retornou isso, a integra√ß√£o com Stripe est√° funcionando!**

**Copiar o `checkout_url` e abrir no navegador para testar pagamento:**
```python
# Copiar URL
print(result['checkout_url'])
```

---

## ‚úÖ PASSO 7: TESTAR PAGAMENTO COMPLETO

### 7.1 Abrir Checkout no Navegador

Colar a URL do passo anterior no navegador.

### 7.2 Preencher Dados de Teste

**Email:** qualquer email (ex: `teste@govgo.com.br`)

**Cart√£o de Teste:**
```
N√∫mero: 4242 4242 4242 4242
Data: 12/34 (qualquer data futura)
CVC: 123 (qualquer 3 d√≠gitos)
Nome: Haroldo Teste
```

**Clicar em "Pay" (Pagar)**

### 7.3 Verificar Webhook Recebido

**No Terminal 1 (Stripe CLI):**
```
[200] POST http://localhost:5001/billing/webhook [evt_abc123...]
```

**No Terminal 2 (Webhook Server):**
```
INFO:WEBHOOK:Processando webhook: checkout.session.completed
INFO:BILLING:Upgrade conclu√≠do: user_id=test_user_001 plan=PLUS
INFO:WEBHOOK:Evento processado: checkout.session.completed [evt_abc123...]
```

‚úÖ **Se apareceu essas mensagens, o webhook est√° funcionando!**

### 7.4 Verificar Banco de Dados

**No Supabase SQL Editor:**
```sql
SELECT user_id, plan_id, gateway_customer_id, gateway_subscription_id
FROM public.user_settings
WHERE user_id = 'test_user_001';
```

**Resultado esperado:**
```
user_id        | plan_id | gateway_customer_id | gateway_subscription_id
---------------|---------|---------------------|------------------------
test_user_001  | 2       | cus_abc123...       | sub_xyz789...
```

‚úÖ **Se `plan_id = 2` e os IDs Stripe est√£o preenchidos, SUCESSO TOTAL!**

---

## ‚úÖ PASSO 8: TESTAR OUTROS PLANOS

### Testar PRO (R$ 199/m√™s)
```python
from gvg_billing import create_checkout_session

result_pro = create_checkout_session(
    user_id='test_user_002',
    plan_code='PRO',
    email='teste.pro@govgo.com.br',
    name='Teste PRO'
)

print(result_pro['checkout_url'])
```

### Testar CORP (R$ 999/m√™s)
```python
result_corp = create_checkout_session(
    user_id='test_user_003',
    plan_code='CORP',
    email='teste.corp@govgo.com.br',
    name='Teste CORP'
)

print(result_corp['checkout_url'])
```

Abrir URLs no navegador e testar pagamento com cart√£o `4242 4242 4242 4242`.

**Verificar banco ap√≥s cada pagamento:**
```sql
SELECT user_id, plan_id FROM public.user_settings 
WHERE user_id IN ('test_user_002', 'test_user_003');
```

**Esperado:**
```
user_id        | plan_id
---------------|--------
test_user_002  | 3       (PRO)
test_user_003  | 4       (CORP)
```

---

## ‚úÖ PASSO 9: TESTAR CANCELAMENTO

```python
from gvg_billing import cancel_subscription

# Cancelar assinatura do test_user_001
result = cancel_subscription('test_user_001')
print(result)
```

**Resultado esperado:**
```python
{
    'status': 'success',
    'ends_at': 1699564800  # Timestamp do fim do per√≠odo pago
}
```

**Verificar no Stripe Dashboard:**
1. https://dashboard.stripe.com/test/subscriptions
2. Buscar subscription do `test_user_001`
3. Deve aparecer **"Cancels on [data]"**

---

## ‚úÖ PASSO 10: SIMULAR EVENTOS MANUALMENTE

Voc√™ pode for√ßar o Stripe a enviar eventos de teste:

### Simular Checkout Completo
```powershell
stripe trigger checkout.session.completed
```

### Simular Cancelamento de Assinatura
```powershell
stripe trigger customer.subscription.deleted
```

**Verificar logs no Terminal 2** para confirmar processamento.

---

## üéÆ PR√ìXIMO: INTEGRAR COM UI (GvG_Search_Browser.py)

Agora que o backend est√° funcionando 100%, precisa adicionar:

### 1. Bot√µes de Upgrade na Interface

```python
# Em GvG_Search_Browser.py
html.Div([
    html.H3("Planos Dispon√≠veis"),
    
    # Plano PLUS
    html.Div([
        html.H4("PLUS - R$ 49,00/m√™s"),
        html.Button("Assinar PLUS", id='btn-upgrade-plus'),
    ]),
    
    # Plano PRO
    html.Div([
        html.H4("PRO - R$ 199,00/m√™s"),
        html.Button("Assinar PRO", id='btn-upgrade-pro'),
    ]),
    
    # Plano CORP
    html.Div([
        html.H4("CORP - R$ 999,00/m√™s"),
        html.Button("Assinar CORP", id='btn-upgrade-corp'),
    ]),
])
```

### 2. Callback para Redirecionar ao Stripe

```python
from dash import dcc

# Adicionar componente Location no layout
app.layout = html.Div([
    dcc.Location(id='url', refresh=True),
    # ... resto do layout
])

# Callback PLUS
@app.callback(
    Output('url', 'href'),
    Input('btn-upgrade-plus', 'n_clicks'),
    State('store-session', 'data'),
    prevent_initial_call=True
)
def upgrade_plus(n, session):
    if not n or not session:
        return dash.no_update
    
    result = create_checkout_session(
        user_id=session['user_id'],
        plan_code='PLUS',
        email=session['email'],
        name=session.get('name', '')
    )
    
    if 'error' in result:
        # TODO: Mostrar erro na tela
        return dash.no_update
    
    return result['checkout_url']  # Redireciona!

# Repetir para PRO e CORP...
```

### 3. P√°ginas de Retorno

```python
# /checkout/success
@app.callback(
    Output('page-content', 'children'),
    Input('url', 'pathname')
)
def display_page(pathname):
    if pathname == '/checkout/success':
        return html.Div([
            html.H2("‚úÖ Pagamento Confirmado!"),
            html.P("Seu plano ser√° ativado em instantes."),
            dcc.Link("Voltar ao painel", href="/"),
        ])
    
    elif pathname == '/checkout/cancel':
        return html.Div([
            html.H2("‚ùå Pagamento Cancelado"),
            html.P("Voc√™ pode tentar novamente quando quiser."),
            dcc.Link("Voltar aos planos", href="/pricing"),
        ])
    
    # ... outras p√°ginas
```

---

## üìä RESUMO: ONDE CADA COISA EST√Å

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ BANCO DE DADOS (Supabase)                                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ system_plans                                                ‚îÇ
‚îÇ   ‚îú‚îÄ id: 1, code: 'FREE'                                    ‚îÇ
‚îÇ   ‚îú‚îÄ id: 2, code: 'PLUS'  ‚Üê Plano no sistema               ‚îÇ
‚îÇ   ‚îú‚îÄ id: 3, code: 'PRO'                                     ‚îÇ
‚îÇ   ‚îî‚îÄ id: 4, code: 'CORP'                                    ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ user_settings                                               ‚îÇ
‚îÇ   ‚îú‚îÄ user_id: 'test_user_001'                              ‚îÇ
‚îÇ   ‚îú‚îÄ plan_id: 2 (PLUS)                                      ‚îÇ
‚îÇ   ‚îú‚îÄ gateway_customer_id: 'cus_...' ‚Üê ID do Stripe         ‚îÇ
‚îÇ   ‚îî‚îÄ gateway_subscription_id: 'sub_...' ‚Üê ID do Stripe     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üï
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ C√ìDIGO PYTHON (gvg_billing.py)                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ PLAN_PRICE_MAP = {                                          ‚îÇ
‚îÇ   'PLUS': 'price_1SGm4w07BrIy6xMU6KEi2GKG',  ‚Üê Mapeamento ‚îÇ
‚îÇ   'PRO': 'price_1SGm5f07BrIy6xMUIu9Cn1MW',                 ‚îÇ
‚îÇ   'CORP': 'price_1SGm6807BrIy6xMU0KBcDAUg',                ‚îÇ
‚îÇ }                                                            ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ create_checkout_session(user_id, plan_code='PLUS')          ‚îÇ
‚îÇ   ‚îî‚îÄ> Busca PLAN_PRICE_MAP['PLUS']                         ‚îÇ
‚îÇ   ‚îî‚îÄ> Chama stripe.checkout.Session.create()               ‚îÇ
‚îÇ   ‚îî‚îÄ> Retorna checkout_url                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üï
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ STRIPE (API/Dashboard)                                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Products:                                                    ‚îÇ
‚îÇ   ‚îú‚îÄ prod_TDCTCkvSbX4EwI (GovGo PLUS)                      ‚îÇ
‚îÇ   ‚îú‚îÄ prod_TDCUWvlmb503lF (GovGo PRO)                       ‚îÇ
‚îÇ   ‚îî‚îÄ prod_TDCVwbhfpMar99 (GovGo CORP)                      ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ Prices:                                                      ‚îÇ
‚îÇ   ‚îú‚îÄ price_1SGm4w... ‚Üí R$ 49,00/m√™s  ‚Üê Usado na cobran√ßa  ‚îÇ
‚îÇ   ‚îú‚îÄ price_1SGm5f... ‚Üí R$ 199,00/m√™s                       ‚îÇ
‚îÇ   ‚îî‚îÄ price_1SGm6807... ‚Üí R$ 999,00/m√™s                     ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ Customers:                                                   ‚îÇ
‚îÇ   ‚îî‚îÄ cus_abc123... (criado ap√≥s pagamento)                 ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ Subscriptions:                                               ‚îÇ
‚îÇ   ‚îî‚îÄ sub_xyz789... (criado ap√≥s pagamento)                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ ENTENDEU O LINK?

**Resumo em 3 linhas:**

1. **Usu√°rio clica "Upgrade PLUS"** ‚Üí C√≥digo busca `price_1SGm4w...` no `PLAN_PRICE_MAP`
2. **Stripe processa pagamento de R$ 49,00** usando esse Price ID
3. **Webhook atualiza banco** com `plan_id = 2` (PLUS) + IDs do Stripe

**Voc√™ N√ÉO precisa:**
- ‚ùå Usar Product ID (`prod_...`) no c√≥digo
- ‚ùå Criar l√≥gica de cobran√ßa manual
- ‚ùå Calcular valores (Stripe faz isso)

**Voc√™ S√ì precisa:**
- ‚úÖ Mapear `plan_code` ‚Üí `price_id` no `PLAN_PRICE_MAP`
- ‚úÖ Chamar `create_checkout_session()`
- ‚úÖ Deixar webhook processar o pagamento

---

## üöÄ STATUS ATUAL

- ‚úÖ Backend Stripe **100% funcional**
- ‚úÖ Webhook **100% funcional**
- ‚úÖ Price IDs **configurados**
- ‚è≥ UI do GvG_Search_Browser (pr√≥ximo passo)

**Voc√™ est√° em:** üü¢ **PRONTO PARA TESTAR PAGAMENTOS!**

Siga os passos 1-10 acima e me avise se tiver algum erro! üéâ
